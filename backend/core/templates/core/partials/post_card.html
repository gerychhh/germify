{# core/templates/core/partials/post_card.html #}
{#
  –û–∂–∏–¥–∞–µ—Ç:
    - post
    - user
    - liked_posts_ids  (—Å–ø–∏—Å–æ–∫ id –ø–æ—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ª–∞–π–∫–Ω—É–ª —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
    - following_ids    (—Å–ø–∏—Å–æ–∫ id –∞–≤—Ç–æ—Ä–æ–≤, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö –ø–æ–¥–ø–∏—Å–∞–Ω —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
    - show_follow      (True/False) ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ª–∏ –∫–Ω–æ–ø–∫—É –ø–æ–¥–ø–∏—Å–∫–∏ —É –∞–≤—Ç–æ—Ä–∞
#}

<article class="post-card">
    <div class="post-layout">
        <div class="post-main">
            <header class="post-header">
                <div class="post-author">
                    <div class="user-avatar-circle">
                        {{ post.author.display_name|default:post.author.username|first|upper }}
                    </div>
                    <div class="post-author-meta">
                        <a href="{% url 'user_profile' post.author.username %}" class="post-author-name">
                            {{ post.author.display_name|default:post.author.username }}
                        </a>
                        <div class="post-author-username">
                            @{{ post.author.username }}
                        </div>
                    </div>

                    {% if show_follow and user.is_authenticated and user != post.author %}
                        <div style="margin-left: 8px;">
                            {% if post.author.id in following_ids %}
                                <a href="{% url 'unfollow_user' post.author.username %}"
                                   class="primary-button"
                                   style="padding:2px 10px; font-size:12px; background:#1f2937; color:#e5e7eb;">
                                    –í—ã –ø–æ–¥–ø–∏—Å–∞–Ω—ã
                                </a>
                            {% else %}
                                <a href="{% url 'follow_user' post.author.username %}"
                                   class="primary-button"
                                   style="padding:2px 10px; font-size:12px;">
                                    –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è
                                </a>
                            {% endif %}
                        </div>
                    {% endif %}
                </div>

                <div class="post-date">
                    {{ post.created_at|date:"d.m.Y H:i" }}
                </div>
            </header>

            <p class="post-text">{{ post.text }}</p>

            <div style="margin-top: 6px; display:flex; justify-content: space-between; align-items: center; gap: 12px;">

                <div style="display:flex; align-items:center; gap: 8px;">

                    {% if user.is_authenticated %}
                        <form method="post"
                              action="{% url 'toggle_like' post.id %}"
                              class="like-form"
                              data-post-id="{{ post.id }}">
                            {% csrf_token %}
                            <button type="submit"
                                    class="like-button"
                                    data-liked="{% if post.id in liked_posts_ids %}true{% else %}false{% endif %}"
                                    style="border:none; background:transparent; cursor:pointer; font-size:18px;">
                                {% if post.id in liked_posts_ids %}
                                    ‚ù§Ô∏è
                                {% else %}
                                    ü§ç
                                {% endif %}
                            </button>
                        </form>
                    {% endif %}

                    <span class="like-count" data-post-id="{{ post.id }}" style="font-size:13px; color:#9ca3af;">
                        {{ post.likes.count }} –ª–∞–π–∫–æ–≤
                    </span>
                </div>

                {% if user.is_authenticated and (user == post.author or user.is_superuser) %}
                    <div class="post-actions">
                        <form method="post"
                              action="{% url 'delete_post' post.id %}"
                              class="post-delete-form">
                            {% csrf_token %}
                            <button type="submit" class="post-delete-button">
                                –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </form>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</article>
