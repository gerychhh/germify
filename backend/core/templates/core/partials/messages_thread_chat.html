{# core/partials/messages_thread_chat.html #}

<section class="card messages-chat-card d-flex flex-column" data-username="{{ other_user.username }}">

    <div class="card-header bg-white d-flex align-items-center gap-2">
        {% include "core/partials/avatar.html" with user_obj=other_user size="md" %}

        <div class="d-flex flex-column">
            <a href="{% url 'user_profile' other_user.username %}" class="text-decoration-none">
                <span class="fw-semibold text-body">{{ other_user.display_name|default:other_user.username }}</span>
            </a>
            <span class="text-body-secondary small">@{{ other_user.username }}</span>
        </div>
    </div>

    <div class="d-flex flex-column flex-grow-1" style="min-height:0;">

        <div class="thread-messages flex-grow-1 overflow-auto p-3" style="min-height:0;">
            <div id="messages-list"
                 data-poll-url="{% url 'messages_poll' other_user.username %}"
                 data-last-id="{{ last_id|default:'0' }}">

                {% if messages %}
                    {% for message in messages %}
                        {% include "core/partials/message_item.html" with message=message %}
                    {% endfor %}
                {% else %}
                    <p class="text-body-secondary mb-0">
                        –°–æ–æ–±—â–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç. –ù–∞–ø–∏—à–∏—Ç–µ –ø–µ—Ä–≤–æ–µ üëá
                    </p>
                {% endif %}

            </div>

            <button type="button"
                    id="scroll-bottom-btn"
                    class="scroll-bottom-btn"
                    style="display:none;">
                ‚Üì
                <span class="scroll-bottom-unread" style="display:none;">0</span>
            </button>
        </div>

        <div class="border-top p-2">
            <form id="message-form"
                  method="post"
                  data-send-url="{% url 'messages_send' other_user.username %}">
                {% csrf_token %}
                {{ form.non_field_errors }}

                <div class="d-flex gap-2 align-items-end">
                    <div class="flex-grow-1">
                        {{ form.text.errors }}
                        {{ form.text }}
                    </div>
                    <button type="submit" class="btn btn-primary">
                        –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                    </button>
                </div>
            </form>
        </div>

    </div>

</section>
