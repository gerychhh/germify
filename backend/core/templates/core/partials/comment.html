{% load tz %}

<div class="comment-item"
     data-comment-id="{{ c.id }}"
     data-post-id="{{ c.post.id }}"
     style="margin-left: {{ level }}px;">

    <!-- HEADER -->
    <div class="comment-header">
        <div class="comment-avatar">
            {{ c.author.display_name|default:c.author.username|first|upper }}
        </div>

        <div class="comment-author-block">
            <div class="comment-author-line">
                <b class="comment-display-name">
                    {{ c.author.display_name|default:c.author.username }}
                </b>

                <span class="comment-username">
                    @{{ c.author.username }}
                </span>

                {# –µ—Å–ª–∏ —ç—Ç–æ –æ—Ç–≤–µ—Ç –Ω–∞ –¥—Ä—É–≥–æ–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º, –Ω–∞ —á—Ç–æ –∏–º–µ–Ω–Ω–æ #}
                {% if c.parent %}
                    <span class="comment-reply-meta">
                        –≤ –æ—Ç–≤–µ—Ç @{{ c.parent.author.username }}
                        ¬´{{ c.parent.text|truncatechars:18 }}¬ª
                    </span>
                {% endif %}

                <span class="comment-time">
                    {{ c.created_at|localtime|date:"d.m.Y H:i" }}
                </span>
            </div>
        </div>
    </div>

    <!-- –¢–ï–ö–°–¢ -->
    <div class="comment-text">
        {{ c.text }}
    </div>

    <!-- FOOTER -->
    <div class="comment-footer">

        {# –ª–∞–π–∫ –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π #}
        {% if user.is_authenticated %}
            <form method="post"
                  action="{% url 'toggle_comment_like' c.id %}"
                  class="comment-like-form"
                  data-comment-id="{{ c.id }}">
                {% csrf_token %}
                <button class="comment-like-button"
                        type="submit"
                        data-liked="{% if c.id in liked_comment_ids %}true{% else %}false{% endif %}">
                    {% if c.id in liked_comment_ids %}‚ù§Ô∏è{% else %}ü§ç{% endif %}
                </button>
            </form>
        {% endif %}

        <span class="comment-like-count"
              data-comment-id="{{ c.id }}">
            {{ c.likes.count }} –ª–∞–π–∫–æ–≤
        </span>

        {% if user.is_authenticated %}
            {# –ø–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É "–û—Ç–≤–µ—Ç–∏—Ç—å" #}
            <button class="comment-reply-toggle"
                    type="button"
                    data-comment-id="{{ c.id }}">
                –û—Ç–≤–µ—Ç–∏—Ç—å
            </button>

            {# –∫–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –±–ª–æ–∫ –æ—Ç–≤–µ—Ç–æ–≤ #}
            {% if c.replies.count %}
                <button class="replies-toggle"
                        type="button"
                        data-comment-id="{{ c.id }}">
                    –û—Ç–≤–µ—Ç—ã ({{ c.replies.count }})
                </button>
            {% endif %}

            {# –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è #}
            {% if user == c.author or user.is_superuser %}
                <form method="post"
                      action="{% url 'delete_comment' c.id %}"
                      class="comment-delete-form"
                      data-comment-id="{{ c.id }}"
                      data-post-id="{{ c.post.id }}">
                    {% csrf_token %}
                    <button type="submit"
                            class="comment-delete-btn">
                        –£–¥–∞–ª–∏—Ç—å
                    </button>
                </form>
            {% endif %}
        {% endif %}
    </div>

    {# –§–û–†–ú–ê –û–¢–í–ï–¢–ê (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ –∫–Ω–æ–ø–∫–µ "–û—Ç–≤–µ—Ç–∏—Ç—å") #}
    {% if user.is_authenticated %}
        <form method="post"
              action="{% url 'add_reply' c.id %}"
              class="reply-form hidden"
              data-parent-id="{{ c.id }}"
              data-post-id="{{ c.post.id }}"
              style="margin-left:10px;">
            {% csrf_token %}
            <textarea name="text"
                      class="reply-input"
                      placeholder="–û—Ç–≤–µ—Ç–∏—Ç—å..."
                      required></textarea>
            <button type="submit" class="reply-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </form>
    {% endif %}

    {# –í–õ–û–ñ–ï–ù–ù–´–ï –û–¢–í–ï–¢–´ ‚Äî –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–ø—Ä—è—Ç–∞–Ω—ã, –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –∫–Ω–æ–ø–∫–æ–π "–û—Ç–≤–µ—Ç—ã" #}
    {% if c.replies.exists %}
        <div class="replies-block hidden"
             data-parent-id="{{ c.id }}">
            {% for r in c.replies.all %}
                {% include "core/partials/comment.html" with c=r user=user liked_comment_ids=liked_comment_ids level=level|add:20 %}
            {% endfor %}
        </div>
    {% endif %}

</div>
