<article class="post-card">
    <div class="post-layout">
        <div class="post-main">
            <header class="post-header">
                <div class="post-author">
                    <div class="user-avatar-circle">
                        {{ post.author.display_name|default:post.author.username|first|upper }}
                    </div>
                    <div class="post-author-meta">
                        <a href="{% url 'user_profile' post.author.username %}"
                           class="post-author-name">
                            {{ post.author.display_name|default:post.author.username }}
                        </a>
                        <div class="post-author-username">
                            @{{ post.author.username }}
                        </div>
                    </div>

                    {% if user.is_authenticated and user != post.author %}
                        <div style="margin-left:8px;">
                            {% if post.author.id in following_ids %}
                                <a href="{% url 'unfollow_user' post.author.username %}"
                                   class="primary-button"
                                   style="padding:2px 10px; font-size:12px; background:#1f2937; color:#e5e7eb;">
                                    –í—ã –ø–æ–¥–ø–∏—Å–∞–Ω—ã
                                </a>
                            {% else %}
                                <a href="{% url 'follow_user' post.author.username %}"
                                   class="primary-button"
                                   style="padding:2px 10px; font-size:12px;">
                                    –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è
                                </a>
                            {% endif %}
                        </div>
                    {% endif %}
                </div>

                <div class="post-date">
                    {{ post.created_at|date:"d.m.Y H:i" }}
                </div>
            </header>

            <p class="post-text">{{ post.text }}</p>

            <div class="post-footer-row">
                <div class="post-likes">
                    {% if user.is_authenticated %}
                        <form method="post"
                              action="{% url 'toggle_like' post.id %}"
                              class="like-form"
                              data-post-id="{{ post.id }}">
                            {% csrf_token %}
                            <button type="submit"
                                    class="like-button"
                                    data-liked="{% if post.id in liked_posts_ids %}true{% else %}false{% endif %}"
                                    style="border:none; background:transparent; cursor:pointer; font-size:18px;">
                                {% if post.id in liked_posts_ids %}
                                    ‚ù§Ô∏è
                                {% else %}
                                    ü§ç
                                {% endif %}
                            </button>
                        </form>
                    {% endif %}

                    <span class="like-count"
                          data-post-id="{{ post.id }}"
                          style="font-size:13px; color:#9ca3af;">
                        {{ post.likes.count }} –ª–∞–π–∫–æ–≤
                    </span>
                </div>

                {% if user.is_authenticated and user == post.author %}
                    <form method="post"
                          action="{% url 'delete_post' post.id %}"
                          class="post-delete-form"
                          data-post-id="{{ post.id }}">
                        {% csrf_token %}
                        <button type="submit" class="post-delete-button">
                            –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </form>
                {% endif %}
            </div>

            {# ------ –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò –ö –ü–û–°–¢–£ ------ #}
            <div class="comments-wrap">
                <button type="button"
                        class="comments-toggle"
                        data-post-id="{{ post.id }}">
                    <span class="comments-toggle-label">
                        üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
                    </span>
                    <span class="comments-count-badge">
                        {{ post.comments.count }}
                    </span>
                </button>

                <div class="comments-body hidden"
                     data-post-id="{{ post.id }}">

                    {# –∫–æ—Ä–Ω–µ–≤—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ #}
                    {% for c in post.comments.all %}
                        {% if not c.parent %}
                            {% include "core/partials/comment.html" with c=c user=user liked_comment_ids=liked_comment_ids level=0 %}
                        {% endif %}
                    {% endfor %}

                    {% if user.is_authenticated %}
                        <button type="button"
                                class="comment-add-toggle"
                                data-post-id="{{ post.id }}">
                            –ù–∞–ø–∏—Å–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
                        </button>

                        <form method="post"
                              action="{% url 'add_comment' post.id %}"
                              class="comment-form hidden"
                              data-post-id="{{ post.id }}">
                            {% csrf_token %}
                            <textarea name="text"
                                      class="comment-input"
                                      placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..."
                                      required></textarea>
                            <button type="submit"
                                    class="comment-btn">
                                –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                            </button>
                        </form>
                    {% endif %}
                </div>
            </div>

        </div>
    </div>
</article>
