{% extends "core/base.html" %}
{% load static tz %}

{% block title %}–õ–µ–Ω—Ç–∞ ‚Äî Germify{% endblock %}

{% block extra_head %}{% endblock %}

{% block content %}
<div class="feed-page">

    <!-- –§–æ—Ä–º–∞ –Ω–æ–≤–æ–≥–æ –ø–æ—Å—Ç–∞ -->
    <section class="card feed-new-post-card">
        <div class="card-body p-3">
        <form method="post"
          action="{% url 'create_post' %}"
          class="new-post-form"
          enctype="multipart/form-data"
          data-authenticated="{% if user.is_authenticated %}1{% else %}0{% endif %}"
          data-login-url="{% url 'login' %}?next={{ request.path }}">
        {% csrf_token %}
        <h2 class="h6 mb-2 feed-new-post-title">–ß–µ–º –ø–æ–¥–µ–ª–∏—à—å—Å—è —Å–µ–≥–æ–¥–Ω—è?</h2>

        <textarea
            name="text"
            class="form-control feed-new-post-textarea"
            rows="4"
            placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ.">{% if form.text.value %}{{ form.text.value }}{% endif %}</textarea>

        <!-- PREVIEW -->
        <div class="file-preview mt-2" id="file-preview"></div>

        <!-- PREVIEW –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ -->
        <audio id="voice-preview"
               class="voice-preview hidden mt-2 w-100"
               controls></audio>

        <!-- DRAG & DROP ZONE -->
        <div id="drop-zone" class="drop-zone hidden mt-2 p-3 rounded text-center">
            –ü–µ—Ä–µ—Ç–∞—â–∏ —Ñ–∞–π–ª—ã —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏ –Ω–∞ —Å–∫—Ä–µ–ø–∫—É
        </div>

        <!-- INFO + PROGRESS -->
        <div class="file-info small text-muted mt-2 d-flex gap-3 flex-wrap">
            <span id="file-count">–§–∞–π–ª—ã: 0</span>
            <span id="file-size">–†–∞–∑–º–µ—Ä: 0 MB</span>
        </div>

        <div class="upload-progress hidden mt-2" id="upload-progress">
            <div class="upload-progress-bar" id="upload-progress-bar"></div>
        </div>

        <div class="feed-new-post-footer mt-3 d-flex align-items-center gap-2 flex-wrap">
            <!-- –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥ -->
            <div class="voice-recorder d-flex align-items-center gap-2 me-auto">
                <button type="button"
                        id="voice-record-btn"
                        class="btn btn-outline-primary btn-sm voice-record-btn">
                    üéô –ì–æ–ª–æ—Å
                </button>
                <span id="voice-record-status" class="voice-record-status small text-muted"></span>
            </div>

            <label class="btn btn-outline-secondary btn-sm attach-btn mb-0" title="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª—ã">
                üìé <span class="d-none d-sm-inline">–§–∞–π–ª—ã</span>
                <input type="file"
                       name="attachments"
                       multiple
                       style="display:none;">
            </label>

            <button type="submit" class="btn btn-primary btn-sm primary-button">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
        </div>
    </form>
        </div>
    </section>

    <!-- –õ–µ–Ω—Ç–∞ –ø–æ—Å—Ç–æ–≤ -->
    <section class="posts-list"
             id="posts-list"
             data-next-page="{% if has_next %}{{ next_page }}{% else %}0{% endif %}"
             data-has-next="{% if has_next %}1{% else %}0{% endif %}">
        {% for post in posts %}
            {% include "core/partials/post.html" with post=post user=user liked_posts_ids=liked_posts_ids liked_comment_ids=liked_comment_ids following_ids=following_ids %}
        {% empty %}
        {% endfor %}
    </section>

    <div class="feed-loading" id="feed-loading" style="display:none;">
        –ó–∞–≥—Ä—É–∑–∫–∞ –µ—â—ë –ø–æ—Å—Ç–æ–≤...
    </div>

</div>
{% endblock %}
